var app=angular.module("CorporateDashboardApp",["ui.router","ngAnimate"]);app.filter("moment",function(){return function(t){var e=t,n=parseInt(e.split("-")[0]),r=parseInt(e.split("-")[1])-1,i=parseInt(e.split("-")[2]),o=moment().year(n).month(r).date(i);return o=o.calendar(null,{sameDay:"[Today]",nextDay:"[Tomorrow]",lastDay:"[Yesterday]",lastWeek:"D MMM, YYYY",sameElse:"D MMM, YYYY"})}}),app.config(["$stateProvider","$urlRouterProvider","uiGmapGoogleMapApiProvider",function(t,e,n){n.configure({v:"3.18",key:"AIzaSyBWbn2woYcKBa78EGto81shmbogj-9LfF0"}),e.otherwise("/"),t.state("geospatial",{url:"/",templateUrl:"views/geospatial.html",controller:"GeospatialCtrl as dashboard",resolve:{Employees:["CompanyDataService",function(t){return t.getEmployees()}]}}).state("keyMetrics",{url:"/metrics",templateUrl:"views/key-metrics.html",controller:"KeyMetricsCtrl as dashboard",resolve:{Customers:["CompanyDataService",function(t){return t.getCustomers()}],Issues:["CompanyDataService",function(t){return t.getIssues()}]}}).state("data",{url:"/data",templateUrl:"views/data.html",controller:"DataCtrl as dashboard",resolve:{Issues:["CompanyDataService",function(t){return t.getIssues()}]}})}]),app.controller("DataCtrl",["UIFactory","Issues","CompanyDataService","$scope",function(t,e,n,r){var i=this;this.issues=e,this.toggleNav=t.toggleNav,setInterval(function(){n.getIssues().then(function(t,e){e&&(i.issues=t,r.$apply)})},15e3);var o=[],a=[];angular.forEach(e,function(t){o.includes(t.employee_name)||o.push(t.employee_name),a.includes(t.customer_name)||a.push(t.customer_name)}),this.issuesFilter={status:"",employee_name:"",customer_name:""},this.filterByStatusOptions=[{name:"All",value:""},{name:"Open",value:"open"},{name:"Closed",value:"closed"}],this.filterByEmployeeOptions=[{name:"All",value:""}],angular.forEach(o,function(t){i.filterByEmployeeOptions.push({name:t,value:t})}),this.filterByCustomerOptions=[{name:"All",value:""}],angular.forEach(a,function(t){i.filterByCustomerOptions.push({name:t,value:t})}),this.issuesSortOrderOptions=[{name:"Recent First",value:"-submission_timestamp"},{name:"Recent Last",value:"submission_timestamp"}],this.issuesSortOrder=this.issuesSortOrderOptions[0]}]),app.controller("GeospatialCtrl",["UIFactory","Employees","CompanyDataService","$scope",function(t,e,n,r){function i(){var t=[],e=["#FF6384","#4BC0C0","#FFCE56","#f39c12","#36A2EB","#8e44ad","#1abc9c","#34495e","#e67e22","#c0392b"],n=[];angular.forEach(o.employees,function(e){t.push(e.location),n.push(e.employees)});var r={datasets:[{label:"Employees by Location",data:n,backgroundColor:e}],labels:t},i=$("#geospatialChart");new Chart(i,{data:r,type:"bar",options:{legend:{position:"bottom"},responsive:!1}})}this.employees=e;var o=this;this.toggleNav=t.toggleNav,this.geospatialChart={data:chartData,options:{legend:{position:"bottom"}}},setInterval(function(){n.getEmployees().then(function(t,e){e&&(o.employees=t,i(),r.$apply)})},5e3)}]),app.controller("KeyMetricsCtrl",["UIFactory","Customers","Issues","CompanyDataService","$scope",function(t,e,n,r,i){function o(){var t=[],e=[];angular.forEach(s.customers,function(n){t.push(n.week_of_the_year),e.push(n.number_of_customers)});var n={datasets:[{data:e,label:"Customers"}],labels:t},r=$("#customers");new Chart(r,{data:n,type:"line",options:{legend:{position:"bottom"}}})}function a(){var t=0,e=0,n=0,r=["Jan","Feb","Mar","Apr","May","Jun","Jul"],i=[0,0,0,0,0,0,0];angular.forEach(s.issues,function(r){switch(t++,r.status){case"closed":n++;break;case"open":e++}var o=parseInt(r.submission_timestamp.split("-")[1])-1;i[o]++}),s.openIssues=e,s.totalIssues=t;var o={datasets:[{data:i,label:"Issues"}],labels:r},a=$("#issues");new Chart(a,{data:o,type:"bar",options:{legend:{position:"bottom"}}})}var s=this;this.issues=n,this.customers=e,this.toggleNav=t.toggleNav,o(),a(),setInterval(function(){r.getIssues().then(function(t,e){e&&(s.issues=t,a(),i.$apply)}),r.getCustomers().then(function(t,e){e&&(s.customers=t,o(),i.$apply)})},15e3)}]),app.controller("SidebarCtrl",["UIFactory","$state",function(t,e){this.toggleNav=t.toggleNav,this.isActivePage=function(t){return e.current.name===t}}]),app.factory("CSVToJSON",function(){return function(t,e){for(var n=t.split(","),r=[],i=[],o=0;o<e;o++){var a=n.shift();a=a.toLowerCase().replace(/ /g,"_"),i.push(a)}for(var s=0,l={},o=0;o<n.length;o++)l[i[s]]=n[o],s++,s==e&&(r.push(l),s=0,l={});return r}}),app.factory("UIFactory",function(){return{scrollTo:function(t,e){function n(){setTimeout(function(){$(e).focus()},r)}var r=1e3;$("html, body").animate({scrollTop:$(t).offset().top},r),e&&n()},toggleNav:function(){var t=this;$("body").toggleClass("nav-open"),$("body").hasClass("nav-open")?($(".site-main").attr("aria-hidden",!0),$(".site-sidebar").attr("aria-hidden",!1),$(".site-nav li:first-child a").focus(),$(".site-nav li a").on("click",function(){t.toggleNav()})):($(".site-main").attr("aria-hidden",!1),$(".site-sidebar").attr("aria-hidden",!0),$(".page-title .toggle-nav").focus())},toast:function(t,e){console.log("toastubg");var n=document.querySelector(".toast-container"),r=document.querySelector(".toast");r.classList.remove("success","warning","danger"),r.classList.add(t),n.classList.add("open"),r.innerHTML="\t\t        <p>"+e+'</p>\t\t        <button type="button" aria-label="Close Message" class="close-toast btn-bare"> Close </button>\t\t    ',document.querySelector(".close-toast").addEventListener("click",function(){n.classList.remove("open")})}}}),app.factory("CompanyDataService",["$http","$q","CSVToJSON","UIFactory",function(t,e,n,r){function i(t,e){return t.length===e.length&&t.toString()===e.toString()}var o="./data/",a=[],s=[],l=[];return{getEmployees:function(){return e(function(e,n){t.get(o+"employees.json").then(function(t){var n=!i(t.data,a);a=t.data,e(a,n)}).catch(function(t){r.toast("danger","Unable to get the company employees"),console.log(t)})})},getCustomers:function(){return e(function(e,a){t.get(o+"customers.csv").then(function(t){var r=n(t.data,2),o=!i(r,s);s=r,e(s,o)}).catch(function(t){r.toast("danger","Unable to get the company customers"),console.log(t)})})},getIssues:function(){return e(function(e,n){t.get(o+"issues.json").then(function(t){var n=!i(t.data,l);l=t.data,e(l,n)}).catch(function(t){r.toast("danger","Unable to get the company issues"),console.log(t)})})}}}]);