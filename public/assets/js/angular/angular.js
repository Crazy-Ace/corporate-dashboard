var app=angular.module("CorporateDashboardApp",["ui.router","ngAnimate","chart.js"]);app.filter("moment",function(){return function(t){var e=t,n=parseInt(e.split("-")[0]),r=parseInt(e.split("-")[1])-1,i=parseInt(e.split("-")[2]),a=moment().year(n).month(r).date(i);return a=a.calendar(null,{sameDay:"[Today]",nextDay:"[Tomorrow]",lastDay:"[Yesterday]",lastWeek:"D MMM, YYYY",sameElse:"D MMM, YYYY"})}}),app.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("geospatial",{url:"/",templateUrl:"views/geospatial.html",controller:"GeospatialCtrl as dashboard",resolve:{Employees:["CompanyDataService",function(t){return t.getEmployees()}]}}).state("keyMetrics",{url:"/metrics",templateUrl:"views/key-metrics.html",controller:"KeyMetricsCtrl as dashboard",resolve:{Customers:["CompanyDataService",function(t){return t.getCustomers()}],Issues:["CompanyDataService",function(t){return t.getIssues()}]}}).state("data",{url:"/data",templateUrl:"views/data.html",controller:"DataCtrl as dashboard",resolve:{Issues:["CompanyDataService",function(t){return t.getIssues()}]}})}]),app.controller("DataCtrl",["UIFactory","Issues","CompanyDataService","$scope","$interval",function(t,e,n,r,i){function a(){n.getIssues().then(function(t){t.isNewData&&(o.issues=t.data,r.$apply)})}var o=this;this.issues=e.data,this.toggleNav=t.toggleNav;var s=i(a,1e4);r.$on("$destroy",function(){i.cancel(s)});var l=[],u=[];angular.forEach(e,function(t){l.includes(t.employee_name)||l.push(t.employee_name),u.includes(t.customer_name)||u.push(t.customer_name)}),this.issuesFilter={status:"",employee_name:"",customer_name:""},this.filterByStatusOptions=[{name:"All",value:""},{name:"Open",value:"open"},{name:"Closed",value:"closed"}],this.filterByEmployeeOptions=[{name:"All",value:""}],angular.forEach(l,function(t){o.filterByEmployeeOptions.push({name:t,value:t})}),this.filterByCustomerOptions=[{name:"All",value:""}],angular.forEach(u,function(t){o.filterByCustomerOptions.push({name:t,value:t})}),this.issuesSortOrderOptions=[{name:"Recent First",value:"-submission_timestamp"},{name:"Recent Last",value:"submission_timestamp"}],this.issuesSortOrder=this.issuesSortOrderOptions[0]}]),app.controller("GeospatialCtrl",["UIFactory","Employees","CompanyDataService","$scope","$interval","$timeout",function(t,e,n,r,i,a){function o(){var t=[],e=[];angular.forEach(l.employees,function(n){t.push(n.location),e.push(n.employees)}),l.geospatialChart={data:[e],labels:t,series:["Employees by Location"],options:{legend:{position:"bottom"},responsive:!1}},a(function(){u.css("width","100%"),u.css("height","auto")},500)}function s(){n.getEmployees().then(function(t){t.isNewData&&(l.employees=t.data,o(),r.$apply)})}this.employees=e.data;var l=this;this.toggleNav=t.toggleNav;var u=$("#geospatialChart");o();var c=i(s,1e4);r.$on("$destroy",function(){i.cancel(c)})}]),app.controller("KeyMetricsCtrl",["UIFactory","Customers","Issues","CompanyDataService","$scope","$interval","$timeout",function(t,e,n,r,i,a,o){function s(){var t=[],e=[];angular.forEach(c.customers,function(n){t.push(n.week_of_the_year),e.push(n.number_of_customers)}),c.customersChart={data:[e],labels:t,series:["Customers"],options:{legend:{position:"bottom"},responsive:!1}},o(function(){d.css("width","100%"),d.css("height","auto")},500)}function l(){var t=0,e=0,n=0,r=["Jan","Feb","Mar","Apr","May","Jun","Jul"],i=[0,0,0,0,0,0,0];angular.forEach(c.issues,function(r){switch(t++,r.status){case"closed":n++;break;case"open":e++}var a=parseInt(r.submission_timestamp.split("-")[1])-1;i[a]++}),c.openIssues=e,c.totalIssues=t,c.issuesChart={data:[i],labels:r,series:["Issues"],options:{legend:{position:"bottom"},responsive:!1}},o(function(){f.css("width","100%"),f.css("height","auto")},500)}function u(){r.getIssues().then(function(t){t.isNewData&&(c.issues=t.data,l(),i.$apply)}),r.getCustomers().then(function(t){t.isNewData&&(c.customers=t.data,s(),i.$apply)})}var c=this;this.issues=n.data,this.customers=e.data,this.toggleNav=t.toggleNav;var d=$("#customers");s();var f=$("#issues");l();var h=a(u,1e4);i.$on("$destroy",function(){a.cancel(h)})}]),app.controller("SidebarCtrl",["UIFactory","$state",function(t,e){this.toggleNav=t.toggleNav,this.isActivePage=function(t){return e.current.name===t}}]),app.factory("CSVToJSON",function(){return function(t,e){for(var n=t.split(","),r=[],i=[],a=0;a<e;a++){var o=n.shift();o=o.toLowerCase().replace(/ /g,"_"),i.push(o)}for(var s=0,l={},a=0;a<n.length;a++)l[i[s]]=n[a],s++,s==e&&(r.push(l),s=0,l={});return r}}),app.factory("UIFactory",function(){return{scrollTo:function(t,e){function n(){setTimeout(function(){$(e).focus()},r)}var r=1e3;$("html, body").animate({scrollTop:$(t).offset().top},r),e&&n()},toggleNav:function(){var t=this;$("body").toggleClass("nav-open"),$("body").hasClass("nav-open")?($(".site-main").attr("aria-hidden",!0),$(".site-sidebar").attr("aria-hidden",!1),$(".site-nav li:first-child a").focus(),$(".site-nav li a").on("click",function(){t.toggleNav()})):($(".site-main").attr("aria-hidden",!1),$(".site-sidebar").attr("aria-hidden",!0),$(".page-title .toggle-nav").focus())},toast:function(t,e){console.log("toastubg");var n=document.querySelector(".toast-container"),r=document.querySelector(".toast");r.classList.remove("success","warning","danger"),r.classList.add(t),n.classList.add("open"),r.innerHTML="\t\t        <p>"+e+'</p>\t\t        <button type="button" aria-label="Close Message" class="close-toast btn-bare"> Close </button>\t\t    ',document.querySelector(".close-toast").addEventListener("click",function(){n.classList.remove("open")})}}}),app.factory("CompanyDataService",["$http","$q","CSVToJSON","UIFactory",function(t,e,n,r){function i(t,e){return t.length===e.length&&t.toString()===e.toString()}var a="./data/",o=[],s=[],l=[];return{getEmployees:function(){return e(function(e,n){t.get(a+"employees.json").then(function(t){var n=!i(t.data,o);o=t.data,e({data:t.data,isNewData:n})}).catch(function(t){r.toast("danger","Unable to get the company employees"),console.log(t)})})},getCustomers:function(){return e(function(e,o){t.get(a+"customers.csv").then(function(t){var r=n(t.data,2),a=!i(r,s);s=r,e({data:r,isNewData:a})}).catch(function(t){r.toast("danger","Unable to get the company customers"),console.log(t)})})},getIssues:function(){return e(function(e,n){t.get(a+"issues.json").then(function(t){var n=!i(t.data,l);l=t.data,e({data:t.data,isNewData:n})}).catch(function(t){r.toast("danger","Unable to get the company issues"),console.log(t)})})}}}]);